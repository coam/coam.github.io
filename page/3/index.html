<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>商运物流</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="商运物流">
<meta property="og:url" content="https://coam.co/page/3/index.html">
<meta property="og:site_name" content="商运物流">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="商运物流">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="商运物流" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.png">
  
  
  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <script>
      var yiliaConfig = {
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            
            <img lazy-src="/img/author.jpg" class="js-avatar">
            
        </a>

        <hgroup>
          <h1 class="header-author"><a href="/">张亚飞</a></h1>
        </hgroup>

        
                


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:zyf@lonal.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/zyfmix" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/markdown-gfw-hexo-jekyll/" style="font-size: 10px;">markdown gfw hexo jekyll</a>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://coam.co">商运物流</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/zyfmix/">GitHub</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://wp.iirii.com/">商运技术博客</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于物流设计</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">张亚飞</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img lazy-src="/img/author.jpg" class="js-avatar">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">张亚飞</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <li id="Email"><a class="Email" target="_blank" href="mailto:zyf@lonal.com" title="Email"></a></li>
                            
                                <li id="GitHub"><a class="GitHub" target="_blank" href="https://github.com/zyfmix" title="GitHub"></a></li>
                            
                                <li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
                            
                        </ul>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-Java/LearnRxJava" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/Java/LearnRxJava/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/Java/LearnRxJava/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="RxJava__u76F8_u5173"><a href="#RxJava__u76F8_u5173" class="headerlink" title="RxJava 相关"></a>RxJava 相关</h4><p><a href="https://github.com/mcxiaoke/RxDocs" target="_blank" rel="external">mcxiaoke/RxDocs</a><br><a href="https://github.com/lzyzsd/Awesome-RxJava" target="_blank" rel="external">Awesome-RxJava</a><br><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">RxJava</a><br><a href="https://github.com/ReactiveX/RxAndroid" target="_blank" rel="external">RxAndroid</a><br><a href="https://www.gitbook.com/book/asce1885/android-rd-senior-advanced/details" target="_blank" rel="external">更上一层楼－Android研发工程师高级进阶</a><br><a href="http://www.zhihu.com/question/32179258/answer/54989242" target="_blank" rel="external">RxJava和EventBus的区别？</a><br><a href="https://asce1885.gitbooks.io/android-rd-senior-advanced/content/wo_wei_shi_yao_zhu_zhang_fan_dui_shi_yong_android_fragment.html" target="_blank" rel="external">我为什么主张反对使用Android Fragment</a><br><a href="http://www.jianshu.com/p/40050ded099c" target="_blank" rel="external">RxJava操作实例</a></p>
<p><a href="http://www.jianshu.com/p/2b0bbc5da03d" target="_blank" rel="external">使用StorIO,RxJava处理ContentProvider</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-Java/LearnSupportAnnotations" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/Java/LearnSupportAnnotations/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/Java/LearnSupportAnnotations/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Android_u6CE8_u89E3_u652F_u6301_28Support_Annotations_29"><a href="#Android_u6CE8_u89E3_u652F_u6301_28Support_Annotations_29" class="headerlink" title="Android注解支持(Support Annotations)"></a>Android注解支持(Support Annotations)</h3><p><a href="http://objccn.io/issue-11-6/" target="_blank" rel="external">依赖注入和注解，为什么 Java 比你想象的要好</a><br><a href="http://www.flysnow.org/2015/08/13/android-tech-docs-support-annotations.html" target="_blank" rel="external">Android注解支持(Support Annotations)</a><br><a href="http://www.nljb.net/default/Android%E4%B9%8B%E6%B3%A8%E8%A7%A3%E5%BC%8F%E6%A1%86%E6%9E%B6%E5%8F%8AButterknife%E7%9A%84%E4%BD%BF%E7%94%A8/" target="_blank" rel="external">Android之注解式框架及Butterknife的使用</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-MongoDB/MongoNotes" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/MongoDB/MongoNotes/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/MongoDB/MongoNotes/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h4 id="MongoDB__u7BA1_u7406_u7B14_u8BB0_u6458_u8981"><a href="#MongoDB__u7BA1_u7406_u7B14_u8BB0_u6458_u8981" class="headerlink" title="MongoDB 管理笔记摘要"></a>MongoDB 管理笔记摘要</h4><blockquote>
<p>MongoDB 修改重命名字段名</p>
</blockquote>
<h5 id="u901A_u8FC7_u547D_u4EE4_u884C_u6279_u91CF_u4FEE_u6539"><a href="#u901A_u8FC7_u547D_u4EE4_u884C_u6279_u91CF_u4FEE_u6539" class="headerlink" title="通过命令行批量修改"></a>通过命令行批量修改</h5><blockquote>
<p>修改一级字段名</p>
</blockquote>
<pre><code>CoamReSet:PRIMARY&gt; db.TruckRoadsPath.update({},{$rename:{&quot;Lng&quot;:&quot;lng&quot;}},{multi:true})
WriteResult({ &quot;nMatched&quot; : 2702582, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 2702582 })
</code></pre><blockquote>
<p>修改二级字段名</p>
</blockquote>
<p>CoamReSet:PRIMARY&gt; db.TruckRoadsPath.update({},{$rename:{“PathInfo.Speed”:”PathInfo.speed”}},{multi:true})</p>
<blockquote>
<p>出现以下错误,提示不能更新 PathInfo 为 null 的数据,提示更新失败,但检查数据发现已全部正确更新过来了</p>
</blockquote>
<pre><code>WriteResult({
        &quot;nMatched&quot; : 0,
        &quot;nUpserted&quot; : 0,
        &quot;nModified&quot; : 0,
        &quot;writeError&quot; : {
                &quot;code&quot; : 16837,
                &quot;errmsg&quot; : &quot;cannot use the part (PathInfo of PathInfo.Speed) to traverse the element ({PathInfo: null})&quot;
        }
})
</code></pre><blockquote>
<p>正确的检查非 null 条件下的写法应该是:</p>
</blockquote>
<pre><code>CoamReSet:PRIMARY&gt; db.TruckRoadsPath.update({&quot;PathInfo&quot;:{$ne:null}},{$rename:{&quot;PathInfo.State&quot;:&quot;PathInfo.state&quot;}},{multi:true})
WriteResult({ &quot;nMatched&quot; : 2702158, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 2702156 })
</code></pre><p>参考 <a href="http://stackoverflow.com/questions/4057196/how-do-you-query-this-in-mongo-is-not-null" target="_blank" rel="external">How do you query this in Mongo? (is not null)</a></p>
<hr>
<p>参考<br><a href="http://nosqldb.org/p/50d1cbacbcc7e7cc590007d2" target="_blank" rel="external">如何在MongoDB 修改字段名称,重命名字段</a><br><a href="https://docs.mongodb.org/manual/reference/operator/update/rename/" target="_blank" rel="external">Mongo docs - $rename</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-MongoDB/mongo-replicaSet" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/MongoDB/mongo-replicaSet/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/MongoDB/mongo-replicaSet/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="MongoDB__u590D_u5236_u96C6"><a href="#MongoDB__u590D_u5236_u96C6" class="headerlink" title="MongoDB 复制集"></a>MongoDB 复制集</h3><p>参考 <a href="http://www.codefrom.com/paper/MongoDB%E5%AD%A6%E4%B9%A0%E6%9C%AD%E8%AE%B0%E7%AC%AC%E5%85%AB%E7%AF%87%E4%B9%8BReplica%20Set%20%E5%AE%9E%E6%88%98" target="_blank" rel="external">MongoDB学习札记第八篇之Replica Set 实战</a><br>参考 <a href="http://www.putaor.com/?p=577" target="_blank" rel="external">MongoDB 3.0 复制集集群搭建及安全认证实践</a><br>参考 <a href="http://www.mongoing.com/config_3_0" target="_blank" rel="external">MongoDB 3.0 WT引擎参考配置文件</a><br>参考 <a href="http://www.cnblogs.com/zhoujinyi/p/3554010.html" target="_blank" rel="external">MongoDB 副本集的原理、搭建、应用</a></p>
<p>准备三台mongo服务器 分别为 43.241.222.110 42.96.194.60 和 45.63.50.67 搭建复制集</p>
<p>如果对于怎么安装Mongodb还不清楚的同学可以查看我之前的学习札记</p>
<p>三台MongoDB服务器的配置文件均为 /etc/mongod.cnf</p>
<pre><code>storage:
    dbPath: &quot;/data/home/data/RSMongoDB&quot;
    engine: wiredTiger
    wiredTiger:
        engineConfig:
            cacheSizeGB: 20
        collectionConfig:
            blockCompressor: snappy

systemLog:
   destination: file
   path: &quot;/var/log/mongodb/mongod.log&quot;
   logAppend: true

processManagement:
    fork: true

net:
    #bindIp: 127.0.0.1,43.241.222.110,42.96.194.60  不能绑定外网访问ip,局域网的貌似可以,只能在iptable设定允许指定ip访问27017
    #bindIp: 0.0.0.0
    port: 27017
    # Enable the HTTP interface (Defaults to port 28017).
    http:
        enabled: false
</code></pre><p>第一步:</p>
<p>在三台机器上分别运行（都要运行）</p>
<pre><code>root@ubuntu:/usr/local/mongodb#mongod -f /etc/mongod.cnf --replSet CoamReSet
</code></pre><p>注意这里的 —replSet 参数指定了副本集的名称,每一个副本集都有一个唯一的名称.</p>
<p>等到三台机器都启动完了之后.使用mongo客户端登录其中一台mongod服务器.这里我登录到 43.241.222.110 这台机器</p>
<pre><code>root@ubuntu:~# mongo
</code></pre><p>登录之后要切换到admin数据库,这样我们可以进行副本集的配置,具体怎么配置,代码如下:</p>
<pre><code>&gt; use admin
switched to db admin
</code></pre><p>定义副本集配置变量,这里的 _id:”repset” 和上面命令参数 “ –replSet repset” 要保持一样.</p>
<pre><code>&gt; config = {_id:&quot;CoamReSet&quot;,members:[
         {_id:0,host:&quot;43.241.222.110:27017&quot;,&quot;priority&quot;:1},
         {_id:1,host:&quot;42.96.194.60:27017&quot;,&quot;priority&quot;:1},
         {_id:2,host:&quot;45.63.50.67:27017&quot;,&quot;priority&quot;:0}]}
</code></pre><h4 id="u8F93_u51FA"><a href="#u8F93_u51FA" class="headerlink" title="输出"></a>输出</h4><pre><code>{
    &quot;_id&quot; : &quot;CoamReSet&quot;,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 0,
            &quot;host&quot; : &quot;43.241.222.110:27017&quot;
        },
        {
            &quot;_id&quot; : 1,
            &quot;host&quot; : &quot;42.96.194.60:27017&quot;
        },
        {
            &quot;_id&quot; : 2,
            &quot;host&quot; : &quot;45.63.50.67:27017&quot;
        }
    ]
}
</code></pre><h4 id="u521D_u59CB_u5316_u526F_u672C_u96C6_u914D_u7F6E"><a href="#u521D_u59CB_u5316_u526F_u672C_u96C6_u914D_u7F6E" class="headerlink" title="初始化副本集配置"></a>初始化副本集配置</h4><pre><code>&gt; rs.initiate(config);
</code></pre><h4 id="u8F93_u51FA_u6210_u529F"><a href="#u8F93_u51FA_u6210_u529F" class="headerlink" title="输出成功"></a>输出成功</h4><pre><code>{ &quot;ok&quot; : 1 }
</code></pre><h4 id="u6CE8_u610F_3A_u65B0_u521B_u5EFA_u526F_u672C_u96C6_u5FC5_u987B_u8981_u6570_u636E_u5E93_u6CA1_u6709_u6570_u636E_2C_u5426_u5219_u521D_u59CB_u5316_u4F1A_u63D0_u793A_u4EE5_u4E0B_u9519_u8BEF_3A"><a href="#u6CE8_u610F_3A_u65B0_u521B_u5EFA_u526F_u672C_u96C6_u5FC5_u987B_u8981_u6570_u636E_u5E93_u6CA1_u6709_u6570_u636E_2C_u5426_u5219_u521D_u59CB_u5316_u4F1A_u63D0_u793A_u4EE5_u4E0B_u9519_u8BEF_3A" class="headerlink" title="注意:新创建副本集必须要数据库没有数据,否则初始化会提示以下错误:"></a>注意:新创建副本集必须要数据库没有数据,否则初始化会提示以下错误:</h4><pre><code>{
    &quot;ok&quot; : 0,
    &quot;errmsg&quot; : &quot;&apos;42.96.194.60:27017&apos; has data already, cannot initiate set.&quot;,
    &quot;code&quot; : 110
}
</code></pre><p>先定义 config 的配置信息, 然后通过 rs.initiate(config) 方法,将配置信息初始化.这两个步骤完成之后就表示我们的副本集配置信息初始化完成了,在这个CoamReSet的副本集中我们定义了三台主机（注意在定义配置信息的时候指定的 _id 必须和我们启动mongod的时候指定的参数 —replSet 这个参数的值是一样的.）</p>
<p>过一会,mongodb就会帮我们选举出Primary节点和Secondary节点了.那在mongo客户端,我们可以通过 rs.status() 来查看副本集的状态信息</p>
<pre><code>CoamReSet:SECONDARY&gt; rs.status()
{
    &quot;set&quot; : &quot;CoamReSet&quot;,
    &quot;date&quot; : ISODate(&quot;2015-10-01T09:45:34.924Z&quot;),
    &quot;myState&quot; : 1,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 0,
            &quot;name&quot; : &quot;43.241.222.110:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 167,
            &quot;optime&quot; : Timestamp(1443692712, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T09:45:12Z&quot;),
            &quot;electionTime&quot; : Timestamp(1443692715, 1),
            &quot;electionDate&quot; : ISODate(&quot;2015-10-01T09:45:15Z&quot;),
            &quot;configVersion&quot; : 1,
            &quot;self&quot; : true
        },
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 21,
            &quot;optime&quot; : Timestamp(1443692712, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T09:45:12Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T09:45:33.166Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T09:45:33.564Z&quot;),
            &quot;pingMs&quot; : 16,
            &quot;configVersion&quot; : 1
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 21,
            &quot;optime&quot; : Timestamp(1443692712, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T09:45:12Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T09:45:32.949Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T09:45:33.973Z&quot;),
            &quot;pingMs&quot; : 183,
            &quot;configVersion&quot; : 1
        }
    ],
    &quot;ok&quot; : 1
}
</code></pre><p>其中name表示我么你的主机, health表示主机是否健康（0/1） , state（主节点(1)还是从节点(2),或者是不可达节点)</p>
<p>如果上面信息正常显示出来说明整个副本集群已经建立起来了.这时候我们来验证一下是否是真的能够自动备份数据,是否能够自动从失败中恢复,自动选举新的Primary节点.<br>这个实验我们这样来做:</p>
<h4 id="u5148_u5F80_Primary__u8282_u70B9_uFF0843-241-222-110_uFF09_u63D2_u5165_u6570_u636E_2C_u5728_42-96-194-60__u548C_45-63-50-67__u4E24_u53F0_Secondary__u8282_u70B9_u4E2D_u67E5_u8BE2_u6570_u636E_2C_u9A8C_u8BC1_u662F_u5426_u80FD_u591F_u6B63_u5E38_u7684_u540C_u6B65_u673A_u5668"><a href="#u5148_u5F80_Primary__u8282_u70B9_uFF0843-241-222-110_uFF09_u63D2_u5165_u6570_u636E_2C_u5728_42-96-194-60__u548C_45-63-50-67__u4E24_u53F0_Secondary__u8282_u70B9_u4E2D_u67E5_u8BE2_u6570_u636E_2C_u9A8C_u8BC1_u662F_u5426_u80FD_u591F_u6B63_u5E38_u7684_u540C_u6B65_u673A_u5668" class="headerlink" title="先往 Primary 节点（43.241.222.110）插入数据,在 42.96.194.60 和 45.63.50.67 两台 Secondary 节点中查询数据,验证是否能够正常的同步机器."></a>先往 Primary 节点（43.241.222.110）插入数据,在 42.96.194.60 和 45.63.50.67 两台 Secondary 节点中查询数据,验证是否能够正常的同步机器.</h4><blockquote>
<p>先往 Primary 节点（43.241.222.110）插入数据</p>
</blockquote>
<pre><code>CoamReSet:PRIMARY&gt; use test
switched to db test
CoamReSet:PRIMARY&gt; show collections
CoamReSet:PRIMARY&gt; db.guids.insert({&quot;name&quot;:&quot;replica set&quot;,&quot;author&quot;:&quot;webinglin&quot;})
WriteResult({ &quot;nInserted&quot; : 1 })
CoamReSet:PRIMARY&gt; exit
bye
</code></pre><blockquote>
<p>在 45.63.50.67 Secondary 节点中查询数据,验证是否能够正常的同步机器.</p>
</blockquote>
<pre><code>root@ubuntu:~# mongo --host 45.63.50.67
MongoDB shell version: 3.0.3
connecting to: 45.63.50.67:27017/test
Server has startup warnings:
2015-06-09T17:03:27.744-0700 I CONTROL  [initandlisten] ** WARNING: You are running this process as the root user, which is not re                                      commended.
2015-06-09T17:03:27.744-0700 I CONTROL  [initandlisten]
2015-06-09T17:03:27.745-0700 I CONTROL  [initandlisten]
2015-06-09T17:03:27.745-0700 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is &apos;always&apos;.
2015-06-09T17:03:27.745-0700 I CONTROL  [initandlisten] **        We suggest setting it to &apos;never&apos;
2015-06-09T17:03:27.745-0700 I CONTROL  [initandlisten]
CoamReSet:SECONDARY&gt; show dbs
2015-06-09T17:13:49.138-0700 E QUERY    Error: listDatabases failed:{ &quot;note&quot; : &quot;from execCommand&quot;, &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;not master&quot; }
    at Error (&lt;anonymous&gt;)
    at Mongo.getDBs (src/mongo/shell/mongo.js:47:15)
    at shellHelper.show (src/mongo/shell/utils.js:630:33)
    at shellHelper (src/mongo/shell/utils.js:524:36)
    at (shellhelp2):1:1 at src/mongo/shell/mongo.js:47
CoamReSet:SECONDARY&gt; use test
switched to db test
CoamReSet:SECONDARY&gt; db.guids.find()
Error: error: { &quot;$err&quot; : &quot;not master and slaveOk=false&quot;, &quot;code&quot; : 13435 }
CoamReSet:SECONDARY&gt; rs.slaveOk()
CoamReSet:SECONDARY&gt; rs.slaveOk()
CoamReSet:SECONDARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;557780ebd147e9391020860d&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
CoamReSet:SECONDARY&gt; show collections()
2015-06-09T17:14:24.219-0700 E QUERY    Error: don&apos;t know how to show [collections()]
    at Error (&lt;anonymous&gt;)
    at shellHelper.show (src/mongo/shell/utils.js:733:11)
    at shellHelper (src/mongo/shell/utils.js:524:36)
    at (shellhelp2):1:1 at src/mongo/shell/utils.js:733
CoamReSet:SECONDARY&gt; show collections
guids
system.indexes
CoamReSet:SECONDARY&gt; exit
bye
</code></pre><blockquote>
<p>在 42.96.194.60 Secondary 节点中查询数据,验证是否能够正常的同步机器.</p>
</blockquote>
<pre><code>root@ubuntu:~# mongo --host 42.96.194.60
MongoDB shell version: 3.0.3
connecting to: 42.96.194.60:27017/test
Server has startup warnings:
2015-06-09T17:03:11.647-0700 I CONTROL  [initandlisten] ** WARNING: You are running this process as the root user, which is not re                                      commended.
2015-06-09T17:03:11.647-0700 I CONTROL  [initandlisten]
2015-06-09T17:03:11.647-0700 I CONTROL  [initandlisten]
2015-06-09T17:03:11.648-0700 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is &apos;always&apos;.
2015-06-09T17:03:11.648-0700 I CONTROL  [initandlisten] **        We suggest setting it to &apos;never&apos;
2015-06-09T17:03:11.648-0700 I CONTROL  [initandlisten]
CoamReSet:SECONDARY&gt; rs.slaveOk()
CoamReSet:SECONDARY&gt; show dbs
local  1.078GB
test   0.078GB
CoamReSet:SECONDARY&gt; use test
switched to db test
CoamReSet:SECONDARY&gt; show collections
guids
system.indexes
CoamReSet:SECONDARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;557780ebd147e9391020860d&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
CoamReSet:SECONDARY&gt; exit
bye
</code></pre><p>至此,整个验证过程说明了我们集群部署是成功的.数据能够正常同步了.<br>那么接下来我们还要验证另一种情况,Primary异常终止之后（43.241.222.110）,另外两个Secondary节点会不会自动选举出新的Primary节点呢？<br>这个实验我们这样处理: 将 43.241.222.110 机器的mongod服务停止掉,然后再来连接 42.96.194.60 或者 45.63.50.67 任意一台机器,通过 rs.status() 查看集群状态.</p>
<blockquote>
<p>在Primary节点（43.241.222.110）通过 ps -e | grep mongod 查看mongod服务是否开启,然后通过 killall mongod 或者 kill -15 &lt;进程号&gt; 来杀死mongod进程</p>
</blockquote>
<pre><code>root@ubuntu:~# ps -e | grep mongod
 3279 pts/0    00:00:19 mongod
root@ubuntu:~# killall mongod
</code></pre><blockquote>
<p>登陆从节点 42.96.194.60 ,查看mongo服务器状态</p>
</blockquote>
<pre><code>root@ubuntu:~# mongo --host 42.96.194.60
MongoDB shell version: 3.0.3
connecting to: 42.96.194.60:27017/test
Server has startup warnings:
2015-06-09T17:03:11.647-0700 I CONTROL  [initandlisten] ** WARNING: You are running this process as the root user, which is not recommended.
2015-06-09T17:03:11.647-0700 I CONTROL  [initandlisten]
2015-06-09T17:03:11.647-0700 I CONTROL  [initandlisten]
2015-06-09T17:03:11.648-0700 I CONTROL  [initandlisten] ** WARNING: /sys/kernel/mm/transparent_hugepage/defrag is &apos;always&apos;.
2015-06-09T17:03:11.648-0700 I CONTROL  [initandlisten] **        We suggest setting it to &apos;never&apos;
2015-06-09T17:03:11.648-0700 I CONTROL  [initandlisten]
CoamReSet:SECONDARY&gt; rs.status()
{
    &quot;set&quot; : &quot;CoamReSet&quot;,
    &quot;date&quot; : ISODate(&quot;2015-10-01T10:09:57.981Z&quot;),
    &quot;myState&quot; : 1,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 0,
            &quot;name&quot; : &quot;43.241.222.110:27017&quot;,
            &quot;health&quot; : 0,
            &quot;state&quot; : 8,
            &quot;stateStr&quot; : &quot;(not reachable/healthy)&quot;,
            &quot;uptime&quot; : 0,
            &quot;optime&quot; : Timestamp(0, 0),
            &quot;optimeDate&quot; : ISODate(&quot;1970-01-01T00:00:00Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:09:56.226Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:07:54.850Z&quot;),
            &quot;pingMs&quot; : 18,
            &quot;lastHeartbeatMessage&quot; : &quot;Failed attempt to connect to 43.241.222.110:27017; couldn&apos;t connect to server 43.241.222.110:27017 (43.241.222.110), connection attempt failed&quot;,            &quot;configVersion&quot; : -1
        },
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 1577,
            &quot;optime&quot; : Timestamp(1443693679, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:01:19Z&quot;),
            &quot;electionTime&quot; : Timestamp(1443694079, 1),
            &quot;electionDate&quot; : ISODate(&quot;2015-10-01T10:07:59Z&quot;),
            &quot;configVersion&quot; : 1,
            &quot;self&quot; : true
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 1481,
            &quot;optime&quot; : Timestamp(1443693679, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:01:19Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:09:56.891Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:09:57.259Z&quot;),
            &quot;pingMs&quot; : 440,
            &quot;configVersion&quot; : 1
        }
    ],
    &quot;ok&quot; : 1
}
CoamReSet:SECONDARY&gt; exit
bye
</code></pre><p>通过上面这段代码的观察,我们发现,当把原来的Primary节点停止掉后（43.241.222.110停止）, 那么整个mongodb的副本集群会重新选举出新的Primary节点（ 42.96.194.60 机器）</p>
<p>为了验证一下新选举的Primary是否正常,我们再次验证一把数据的同步情况,先连接到 42.96.194.60 主节点,将原来的数据删掉,再到 45.63.50.67 SECONDARY 进行验证,数据是否也被删除</p>
<blockquote>
<p>连接到 42.96.194.60 主节点,将原来的数据删掉</p>
</blockquote>
<pre><code>root@ubuntu:~# mongo --host 42.96.194.60
CoamReSet:PRIMARY&gt; use test
switched to db test
CoamReSet:PRIMARY&gt; show collections
guids
CoamReSet:PRIMARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
{ &quot;_id&quot; : ObjectId(&quot;560d046f9548a3e5bb8b03c0&quot;), &quot;name&quot; : &quot;zhang&quot;, &quot;author&quot; : &quot;yafei...&quot; }
CoamReSet:PRIMARY&gt; db.guids.remove({name:&quot;zhang&quot;})
WriteResult({ &quot;nRemoved&quot; : 1 })
CoamReSet:PRIMARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
CoamReSet:PRIMARY&gt; exit
bye
</code></pre><blockquote>
<p>再到 45.63.50.67 SECONDARY 进行验证,数据是否也被删除</p>
</blockquote>
<pre><code>root@ubuntu:~# mongo --host 45.63.50.67
CoamReSet:SECONDARY&gt; rs.slaveOk()
CoamReSet:SECONDARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;557780ebd147e9391020860d&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
CoamReSet:SECONDARY&gt; exit
bye
</code></pre><p>实践后发现,先选举的Primary节点也正常工作.我们的整个Mongodb副本集群测试完成.</p>
<h3 id="u52A8_u6001_u6DFB_u52A0_u8282_u70B9_2C_u5220_u9664_u8282_u70B9"><a href="#u52A8_u6001_u6DFB_u52A0_u8282_u70B9_2C_u5220_u9664_u8282_u70B9" class="headerlink" title="动态添加节点,删除节点."></a>动态添加节点,删除节点.</h3><p>在开始这个实验之前,先把 43.241.222.110 的机器重新启动,然后用mongo客户端连到 43.241.222.110 进行验证数据是否也同步了.<br>登录 43.241.222.110 之后,我们发现数据也同步了,然后43.241.222.110节点变成了 Secondary 节点了.</p>
<pre><code>root@ubuntu:~# mongo
CoamReSet:SECONDARY&gt; rs.slaveOk()
CoamReSet:SECONDARY&gt; show dbs
local   0.000GB
syData  0.000GB
test    0.000GB
CoamReSet:SECONDARY&gt; use test
switched to db test
CoamReSet:SECONDARY&gt; show collections
guids
CoamReSet:SECONDARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
CoamReSet:SECONDARY&gt; rs.status()
{
    &quot;set&quot; : &quot;CoamReSet&quot;,
    &quot;date&quot; : ISODate(&quot;2015-10-01T10:21:53.366Z&quot;),
    &quot;myState&quot; : 2,
    &quot;syncingTo&quot; : &quot;42.96.194.60:27017&quot;,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 0,
            &quot;name&quot; : &quot;43.241.222.110:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 68,
            &quot;optime&quot; : Timestamp(1443694583, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:16:23Z&quot;),
            &quot;syncingTo&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;configVersion&quot; : 1,
            &quot;self&quot; : true
        },
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 66,
            &quot;optime&quot; : Timestamp(1443694583, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:16:23Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:21:53.026Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:21:52.588Z&quot;),
            &quot;pingMs&quot; : 16,
            &quot;electionTime&quot; : Timestamp(1443694079, 1),
            &quot;electionDate&quot; : ISODate(&quot;2015-10-01T10:07:59Z&quot;),
            &quot;configVersion&quot; : 1
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 66,
            &quot;optime&quot; : Timestamp(1443694583, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:16:23Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:21:51.818Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:21:53.006Z&quot;),
            &quot;pingMs&quot; : 311,
            &quot;syncingTo&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;configVersion&quot; : 1
        }
    ],
    &quot;ok&quot; : 1
}
CoamReSet:SECONDARY&gt; exit
bye
</code></pre><p>登录到 42.96.194.60 Primary 节点,通过 rs.remove() 方法来删除副本集中的某一个节点,这里我们还是将 43.241.222.110 删除.删除之后我们还往 42.96.194.60 主节点中加入数据.</p>
<pre><code>CoamReSet:PRIMARY&gt; rs.remove(&quot;43.241.222.110:27017&quot;)
{ &quot;ok&quot; : 1 }
CoamReSet:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;CoamReSet&quot;,
    &quot;date&quot; : ISODate(&quot;2015-10-01T10:24:35.061Z&quot;),
    &quot;myState&quot; : 1,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 2455,
            &quot;optime&quot; : Timestamp(1443695065, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:24:25Z&quot;),
            &quot;electionTime&quot; : Timestamp(1443694079, 1),
            &quot;electionDate&quot; : ISODate(&quot;2015-10-01T10:07:59Z&quot;),
            &quot;configVersion&quot; : 2,
            &quot;self&quot; : true
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 2358,
            &quot;optime&quot; : Timestamp(1443695065, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:24:25Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:24:33.256Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:24:34.102Z&quot;),
            &quot;pingMs&quot; : 334,
            &quot;configVersion&quot; : 2
        }
    ],
    &quot;ok&quot; : 1
}
CoamReSet:PRIMARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
CoamReSet:PRIMARY&gt; db.guids.insert({&quot;name&quot;:&quot;remove one node dync&quot;})
WriteResult({ &quot;nInserted&quot; : 1 })
CoamReSet:PRIMARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
{ &quot;_id&quot; : ObjectId(&quot;560d0a1d7d9deef6a0890b1f&quot;), &quot;name&quot; : &quot;remove one node dync&quot; }
CoamReSet:PRIMARY&gt; exit
bye
</code></pre><p>删除 43.241.222.110 节点后,我们往 Primary 节点中加入了新的数据,然后先不要将 43.241.222.110 的 mongod 服务停掉,我们通过mongo连接到 43.241.222.110 的mongod服务来查看数据</p>
<pre><code>root@ubuntu:~# mongo --host 43.241.222.110
&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
&gt; exit
bye
</code></pre><p>实验结果可以知道,我们在 45.63.50.67 新加入的数据 {name:”remove one node dync”} 并没有同步到43.241.222.110（已从副本集中删除）.</p>
<p>为了让实验结果更加确切,我们查看 43.241.222.110 是否有同步了数据:</p>
<p>root@ubuntu:~# mongo –host 45.63.50.67<br>CoamReSet:SECONDARY&gt; db.guids.find()<br>{ “_id” : ObjectId(“557780ebd147e9391020860d”), “name” : “replica set”, “author” : “webinglin” }<br>{ “_id” : ObjectId(“557785bcbb56172c8e069341”), “name” : “remove one node dync” }<br>CoamReSet:SECONDARY&gt; exit<br>bye</p>
<p>实验数据可以看到, 45.63.50.67 同步了在 42.96.194.60 主节点中新增的文档 {“name”:”remove one node dync”},这样就证明了动态删除副本集中的某一个节点的实验成功了.那怎么动态添加节点到副本集中呢？</p>
<p>原理是一样的,但是调用的方法变成了 rs.add(“43.241.222.110:27017”)</p>
<pre><code>CoamReSet:PRIMARY&gt; rs.add(&quot;43.241.222.110:27017&quot;);
{ &quot;ok&quot; : 1 }
CoamReSet:PRIMARY&gt; rs.status()
{
    &quot;set&quot; : &quot;CoamReSet&quot;,
    &quot;date&quot; : ISODate(&quot;2015-10-01T10:32:45.284Z&quot;),
    &quot;myState&quot; : 1,
    &quot;members&quot; : [
        {
            &quot;_id&quot; : 1,
            &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 1,
            &quot;stateStr&quot; : &quot;PRIMARY&quot;,
            &quot;uptime&quot; : 2945,
            &quot;optime&quot; : Timestamp(1443695560, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:32:40Z&quot;),
            &quot;electionTime&quot; : Timestamp(1443694079, 1),
            &quot;electionDate&quot; : ISODate(&quot;2015-10-01T10:07:59Z&quot;),
            &quot;configVersion&quot; : 3,
            &quot;self&quot; : true
        },
        {
            &quot;_id&quot; : 2,
            &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 2849,
            &quot;optime&quot; : Timestamp(1443695560, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:32:40Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:32:43.660Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:32:44.079Z&quot;),
            &quot;pingMs&quot; : 452,
            &quot;syncingTo&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;configVersion&quot; : 2
        },
        {
            &quot;_id&quot; : 3,
            &quot;name&quot; : &quot;43.241.222.110:27017&quot;,
            &quot;health&quot; : 1,
            &quot;state&quot; : 2,
            &quot;stateStr&quot; : &quot;SECONDARY&quot;,
            &quot;uptime&quot; : 2,
            &quot;optime&quot; : Timestamp(1443695560, 1),
            &quot;optimeDate&quot; : ISODate(&quot;2015-10-01T10:32:40Z&quot;),
            &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-01T10:32:44.739Z&quot;),
            &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-01T10:32:43.300Z&quot;),
            &quot;pingMs&quot; : 16,
            &quot;syncingTo&quot; : &quot;42.96.194.60:27017&quot;,
            &quot;configVersion&quot; : 3
        }
    ],
    &quot;ok&quot; : 1
}
CoamReSet:PRIMARY&gt; exit
bye
</code></pre><p>在rs.status()返回的结果中可以看到,43.241.222.110 节点已经成功加入副本集中了.加入之后,理论上应该会把在 43.241.222.110 主节点加入的数据同步过来,刚才删除之后是不会同步的.那这时候重新加入副本集,应该是要同步的.下面是实验结果:</p>
<pre><code>root@ubuntu:~# mongo
CoamReSet:SECONDARY&gt; db.guids.find()
{ &quot;_id&quot; : ObjectId(&quot;560d03099548a3e5bb8b03bf&quot;), &quot;name&quot; : &quot;replica set&quot;, &quot;author&quot; : &quot;webinglin&quot; }
{ &quot;_id&quot; : ObjectId(&quot;560d0a1d7d9deef6a0890b1f&quot;), &quot;name&quot; : &quot;remove one node dync&quot; }
CoamReSet:SECONDARY&gt; exit
bye
</code></pre><p>实验结果显示,动态添加操作也正常.动态的将 43.241.222.110 节点加入到副本集中能够保证数据同步成功.</p>
<hr>
<p>注意</p>
<p>在调用 rs.add(“host:ip”) 或者 rs.remove(“host:ip”) 的时候,必须要在 Primary 节点中进行.</p>
<p>add方法可以加入一个document对象,这样就可以在指定具体的Secondary节点的更多的设置项了,比如指定为priority: 0 或 priority: 0,hidden: true 或 priority:0,hidden:true,arbiterOnly:true</p>
<pre><code>{
  _id: &lt;int&gt;,
  host: &lt;string&gt;,
  arbiterOnly: &lt;boolean&gt;,
  buildIndexes: &lt;boolean&gt;,
  hidden: &lt;boolean&gt;,
  priority: &lt;number&gt;,
  tags: &lt;document&gt;,
  slaveDelay: &lt;int&gt;,
  votes: &lt;number&gt;
}
</code></pre><p>怎么对副本集进行权限验证,参考主从复制的安全部分,也是通过openssl来生成keyfile,然后再启动mongod的时候指定keyFile来设置安全的</p>
<hr>
<blockquote>
<p>也可以在三个主机的复制集添加以下配置</p>
</blockquote>
<pre><code>replication:
##oplog大小
 oplogSizeMB: 20
##复制集名称
 replSetName: CoamReSet
</code></pre><hr>
<h3 id="u590D_u5236_u96C6_u4F18_u5148_u7EA7_u95EE_u9898"><a href="#u590D_u5236_u96C6_u4F18_u5148_u7EA7_u95EE_u9898" class="headerlink" title="复制集优先级问题"></a>复制集优先级问题</h3><blockquote>
<p>默认设定节点 43.241.222.110 为Primary主节点,由于初始配置中没有设定,于是在主节点服务器重启后 43.241.222.110 自动切换成 从节点,而 42.96.194.60 切换成了主节点导致应用程序连接错误<br>于是在当前主节点 43.241.222.110 通过命令行手动切换主节点到 43.241.222.110</p>
</blockquote>
<pre><code>CoamReSet:PRIMARY&gt; rs.status()
{
        &quot;set&quot; : &quot;CoamReSet&quot;,
        &quot;date&quot; : ISODate(&quot;2015-10-09T11:28:28.585Z&quot;),
        &quot;myState&quot; : 1,
        &quot;members&quot; : [
                {
                        &quot;_id&quot; : 1,
                        &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
                        &quot;health&quot; : 1,
                        &quot;state&quot; : 1,
                        &quot;stateStr&quot; : &quot;PRIMARY&quot;,
                        &quot;uptime&quot; : 614570,
                        &quot;optime&quot; : Timestamp(1444378212, 1),
                        &quot;optimeDate&quot; : ISODate(&quot;2015-10-09T08:10:12Z&quot;),
                        &quot;electionTime&quot; : Timestamp(1444378334, 1),
                        &quot;electionDate&quot; : ISODate(&quot;2015-10-09T08:12:14Z&quot;),
                        &quot;configVersion&quot; : 3,
                        &quot;self&quot; : true
                },
                {
                        &quot;_id&quot; : 2,
                        &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
                        &quot;health&quot; : 0,
                        &quot;state&quot; : 8,
                        &quot;stateStr&quot; : &quot;(not reachable/healthy)&quot;,
                        &quot;uptime&quot; : 0,
                        &quot;optime&quot; : Timestamp(0, 0),
                        &quot;optimeDate&quot; : ISODate(&quot;1970-01-01T00:00:00Z&quot;),
                        &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-09T11:28:27.754Z&quot;),
                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-06T08:52:51.239Z&quot;),
                        &quot;pingMs&quot; : 406,
                        &quot;lastHeartbeatMessage&quot; : &quot;Failed attempt to connect to 45.63.50.67:27017; couldn&apos;t connect to server 45.63.50.67:27017 (45.63.50.67), connection attempt failed&quot;,
                        &quot;configVersion&quot; : -1
                },
                {
                        &quot;_id&quot; : 3,
                        &quot;name&quot; : &quot;43.241.222.110:27017&quot;,
                        &quot;health&quot; : 1,
                        &quot;state&quot; : 2,
                        &quot;stateStr&quot; : &quot;SECONDARY&quot;,
                        &quot;uptime&quot; : 90994,
                        &quot;optime&quot; : Timestamp(1444378212, 1),
                        &quot;optimeDate&quot; : ISODate(&quot;2015-10-09T08:10:12Z&quot;),
                        &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-09T11:28:27.532Z&quot;),
                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-09T11:28:27.299Z&quot;),
                        &quot;pingMs&quot; : 15,
                        &quot;configVersion&quot; : 3
                }
        ],
        &quot;ok&quot; : 1
}

CoamReSet:PRIMARY&gt; config = rs.conf()
{
        &quot;_id&quot; : &quot;CoamReSet&quot;,
        &quot;version&quot; : 3,
        &quot;members&quot; : [
                {
                        &quot;_id&quot; : 1,
                        &quot;host&quot; : &quot;42.96.194.60:27017&quot;,
                        &quot;arbiterOnly&quot; : false,
                        &quot;buildIndexes&quot; : true,
                        &quot;hidden&quot; : false,
                        &quot;priority&quot; : 1,
                        &quot;tags&quot; : {

                        },
                        &quot;slaveDelay&quot; : 0,
                        &quot;votes&quot; : 1
                },
                {
                        &quot;_id&quot; : 2,
                        &quot;host&quot; : &quot;45.63.50.67:27017&quot;,
                        &quot;arbiterOnly&quot; : false,
                        &quot;buildIndexes&quot; : true,
                        &quot;hidden&quot; : false,
                        &quot;priority&quot; : 1,
                        &quot;tags&quot; : {

                        },
                        &quot;slaveDelay&quot; : 0,
                        &quot;votes&quot; : 1
                },
                {
                        &quot;_id&quot; : 3,
                        &quot;host&quot; : &quot;43.241.222.110:27017&quot;,
                        &quot;arbiterOnly&quot; : false,
                        &quot;buildIndexes&quot; : true,
                        &quot;hidden&quot; : false,
                        &quot;priority&quot; : 1,
                        &quot;tags&quot; : {

                        },
                        &quot;slaveDelay&quot; : 0,
                        &quot;votes&quot; : 1
                }
        ],
        &quot;settings&quot; : {
                &quot;chainingAllowed&quot; : true,
                &quot;heartbeatTimeoutSecs&quot; : 10,
                &quot;getLastErrorModes&quot; : {

                },
                &quot;getLastErrorDefaults&quot; : {
                        &quot;w&quot; : 1,
                        &quot;wtimeout&quot; : 0
                }
        }
}
</code></pre><blockquote>
<p>设置第一个节点 42.96.194.60 优先级为1,第二个节点 45.63.50.67 优先级为0,第三个节点 43.241.222.110 优先级为2;</p>
</blockquote>
<pre><code>CoamReSet:PRIMARY&gt; config.members[0].priority = 1
1
CoamReSet:PRIMARY&gt; config.members[1].priority = 0
0
CoamReSet:PRIMARY&gt; config.members[2].priority = 2
2
CoamReSet:PRIMARY&gt; rs.reconfig(config)
{ &quot;ok&quot; : 1 }
CoamReSet:PRIMARY&gt; rs.status()
{
        &quot;set&quot; : &quot;CoamReSet&quot;,
        &quot;date&quot; : ISODate(&quot;2015-10-09T12:03:37.679Z&quot;),
        &quot;myState&quot; : 2,
        &quot;syncingTo&quot; : &quot;43.241.222.110:27017&quot;,
        &quot;members&quot; : [
                {
                        &quot;_id&quot; : 1,
                        &quot;name&quot; : &quot;42.96.194.60:27017&quot;,
                        &quot;health&quot; : 1,
                        &quot;state&quot; : 2,
                        &quot;stateStr&quot; : &quot;SECONDARY&quot;,
                        &quot;uptime&quot; : 616679,
                        &quot;optime&quot; : Timestamp(1444392119, 1),
                        &quot;optimeDate&quot; : ISODate(&quot;2015-10-09T12:01:59Z&quot;),
                        &quot;syncingTo&quot; : &quot;43.241.222.110:27017&quot;,
                        &quot;configVersion&quot; : 5,
                        &quot;self&quot; : true
                },
                {
                        &quot;_id&quot; : 2,
                        &quot;name&quot; : &quot;45.63.50.67:27017&quot;,
                        &quot;health&quot; : 0,
                        &quot;state&quot; : 8,
                        &quot;stateStr&quot; : &quot;(not reachable/healthy)&quot;,
                        &quot;uptime&quot; : 0,
                        &quot;optime&quot; : Timestamp(0, 0),
                        &quot;optimeDate&quot; : ISODate(&quot;1970-01-01T00:00:00Z&quot;),
                        &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-09T12:03:35.875Z&quot;),
                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-06T08:52:51.239Z&quot;),
                        &quot;pingMs&quot; : 406,
                        &quot;lastHeartbeatMessage&quot; : &quot;Failed attempt to connect to 45.63.50.67:27017; couldn&apos;t connect to server 45.63.50.67:27017 (45.63.50.67), connection attempt failed&quot;,
                        &quot;configVersion&quot; : -1
                },
                {
                        &quot;_id&quot; : 3,
                        &quot;name&quot; : &quot;43.241.222.110:27017&quot;,
                        &quot;health&quot; : 1,
                        &quot;state&quot; : 1,
                        &quot;stateStr&quot; : &quot;PRIMARY&quot;,
                        &quot;uptime&quot; : 93103,
                        &quot;optime&quot; : Timestamp(1444392119, 1),
                        &quot;optimeDate&quot; : ISODate(&quot;2015-10-09T12:01:59Z&quot;),
                        &quot;lastHeartbeat&quot; : ISODate(&quot;2015-10-09T12:03:35.817Z&quot;),
                        &quot;lastHeartbeatRecv&quot; : ISODate(&quot;2015-10-09T12:03:36.764Z&quot;),
                        &quot;pingMs&quot; : 17,
                        &quot;electionTime&quot; : Timestamp(1444390463, 1),
                        &quot;electionDate&quot; : ISODate(&quot;2015-10-09T11:34:23Z&quot;),
                        &quot;configVersion&quot; : 5
                }
        ],
        &quot;ok&quot; : 1
}
</code></pre><p>可以看到 43.241.222.110 已经成功切换成主节点了<br>关闭主节点 43.241.222.110 后,发现两个从节点没有自动切换成主节点,相当于关闭了 MongoDB 复制集功能<br><a href="http://debugo.com/mongo-rs-prio/" target="_blank" rel="external">MongoDB RS优先级设置</a><br><a href="http://docs.mongodb.org/manual/tutorial/force-member-to-be-primary/" target="_blank" rel="external">http://docs.mongodb.org/manual/tutorial/force-member-to-be-primary/</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-MongoDB/mongo-slave" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/MongoDB/mongo-slave/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/MongoDB/mongo-slave/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="MongoDB__u4E3B_u52A8_u590D_u5236"><a href="#MongoDB__u4E3B_u52A8_u590D_u5236" class="headerlink" title="MongoDB 主动复制"></a>MongoDB 主动复制</h2><p>参考 <a href="http://www.lanceyan.com/tech/mongodb/mongodb_cluster_1.html" target="_blank" rel="external">http://www.lanceyan.com/tech/mongodb/mongodb_cluster_1.html</a><br>参考 <a href="http://segmentfault.com/a/1190000002924522" target="_blank" rel="external">MongoDB学习札记第六篇之主从复制</a><br>参考 <a href="http://www.jianshu.com/p/2825a66d6aed" target="_blank" rel="external">高可用的MongoDB集群</a></p>
<blockquote>
<p>在大数据的时代,传统的关系型数据库要能更高的服务必须要解决高并发读写、海量数据高效存储、高可扩展性和高可用性这些难题.不过就是因为这些问题Nosql诞生了.</p>
</blockquote>
<p>NOSQL有这些优势:</p>
<p>大数据量,可以通过廉价服务器存储大量的数据,轻松摆脱传统mysql单表存储量级限制.</p>
<p>高扩展性,Nosql去掉了关系数据库的关系型特性,很容易横向扩展,摆脱了以往老是纵向扩展的诟病.</p>
<p>高性能,Nosql通过简单的key-value方式获取数据,非常快速.还有NoSQL的Cache是记录级的,是一种细粒度的Cache,所以NoSQL在这个层面上来说就要性能高很多.</p>
<p>灵活的数据模型,NoSQL无需事先为要存储的数据建立字段,随时可以存储自定义的数据格式.而在关系数据库里,增删字段是一件非常麻烦的事情.如果是非常大数据量的表,增加字段简直就是一个噩梦.</p>
<p>高可用,NoSQL在不太影响性能的情况,就可以方便的实现高可用的架构.比如mongodb通过mongos、mongo分片就可以快速配置出高可用配置.</p>
<p>在nosql数据库里,大部分的查询都是键值对（key、value）的方式.MongoDB是一个介于关系数据库和非关系数据库之间的产品,是非关系数据库当中最像关系数据库的.支持类似于面向对象的查询语言,几乎可以实现类似关系数据库单表查询的绝大部分功能,而且还支持对数据建立索引.所以这个非常方便,我们可以用sql操作MongoDB,从关系型数据库迁移过来,开发人员学习成本会大大减少.如果再对底层的sql API做一层封装,开发基本可以感觉不到mongodb和关系型数据库的区别.同样MongoDB也是号称自己能够快速搭建一个高可用可扩展的的分布式集群,网上有很多搭建的文章,在我们搭建的时候还需要查找修改很多东西,所以把自己实战的步骤记录下来以备忘.我们看看如何一步一步搭建这个东东.</p>
<p>一、mongodb单实例.这种配置只适合简易开发时使用,生产使用不行,因为单节点挂掉整个数据业务全挂,如下图.<br>虽然不能生产使用,但这个模式可以快速搭建启动,并且能够用mongodb的命令操作数据库.下面列出在linux下安装单节点mongodb的步骤</p>
<p>二、主从模式.使用mysql数据库时大家广泛用到,采用双机备份后主节点挂掉了后从节点可以接替主机继续服务.所以这种模式比单节点的高可用性要好很多.<br>下面看一下怎么一步步搭建一个mongodb的主从复制节点:<br>1、准备两台机器 43.241.222.110 和 42.96.194.60. 43.241.222.110 当作主节点, 42.96.194.60作为从节点.<br>2、分别下载 mongodb 安装程序包.在 43.241.222.110 上建立文件夹 /home/data/mongodb,42.96.194.60 建立文件夹 /home/data/mongodb<br>两台MongoDB服务器的配置文件均为 /etc/mongod.cnf</p>
<pre><code>storage:
    dbPath: &quot;/data/home/data/mongodb&quot;
    engine: wiredTiger
    wiredTiger:
        engineConfig:
            cacheSizeGB: 20
        collectionConfig:
            blockCompressor: snappy

systemLog:
   destination: file
   path: &quot;/var/log/mongodb/mongod.log&quot;
   logAppend: true

processManagement:
    fork: true

net:
    #bindIp: 127.0.0.1,43.241.222.110,42.96.194.60  不能绑定外网访问ip,局域网的貌似可以,只能在iptable设定允许指定ip访问27017
    #bindIp: 0.0.0.0
    port: 27017
    # Enable the HTTP interface (Defaults to port 28017).
    http:
        enabled: false
</code></pre><p>3、在43.241.222.110启动mongodb主节点程序.注意后面的这个 “-master”参数,标示主节点.启动主节点 </p>
<pre><code>sudo mongod -f /etc/mongod.cnf -master
</code></pre><p>4、在42.96.194.60启动 mongodb 从节点程序.关键配置,指定主节点ip地址和端口 -source 43.241.222.110:27017 和 标示从节点 -slave 参数.</p>
<pre><code>sudo mongod -f /etc/mongod.cnf -slave -source 43.241.222.110:27017
</code></pre><p>输出日志如下,成功！</p>
<p>#日志显示从节点 从主节点同步复制数据</p>
<pre><code>[replslave] repl: from host:43.241.222.110:27017
</code></pre><p>配置完Mongo主从复制后开始测试主从复制.</p>
<p>在主节点上连接到终端:</p>
<pre><code>mongo 127.0.0.1
</code></pre><p>#建立test 数据库.</p>
<pre><code>use test;
</code></pre><p>往testdb表插入数据.</p>
<pre><code>&gt; db.testdb.insert({&quot;test1&quot;:&quot;testval1&quot;})
</code></pre><p>查询testdb数据看看是否成功.</p>
<pre><code>&gt; db.testdb.find();
{ &quot;_id&quot; : ObjectId(&quot;5284e5cb1f4eb215b2ecc463&quot;), &quot;test1&quot; : &quot;testval1&quot; }
</code></pre><p>检查从主机的数据.</p>
<pre><code>mongo 127.0.0.1
</code></pre><p>查看当前数据库.</p>
<pre><code>&gt; show dbs;
  local   0.203125GB
  test    0.203125GB

use test;
db.testdb.find();
{ &quot;_id&quot; : ObjectId(&quot;5284e5cb1f4eb215b2ecc463&quot;), &quot;test1&quot; : &quot;testval1&quot; }
</code></pre><p>查询后数据已经同步过来了.再看看日志,发现从主机确实从主机同步了数据.</p>
<p>查看服务状态</p>
<pre><code>&gt; db.printReplicationInfo();
this is a slave, printing slave replication info.
source:   43.241.222.110:27017
  syncedTo: Sun Nov 17 2013 16:04:02 GMT+0800 (CST) = -54 secs ago (-0.01hrs)
</code></pre><p>到此主从结构的mongodb搭建好了.</p>
<p>参考 <a href="http://segmentfault.com/a/1190000002924522" target="_blank" rel="external">MongoDB学习札记第六篇之主从复制</a></p>
<p><a href="http://dev.guanghe.tv/2015/05/mongdb3-upgrade-bug.html" target="_blank" rel="external">MongoDB 3.0 复制集升级操作以及坑</a></p>
<hr>
<h3 id="u95EE_u9898_u5206_u6790"><a href="#u95EE_u9898_u5206_u6790" class="headerlink" title="问题分析"></a>问题分析</h3><p>进入MongoShell执行以下命令</p>
<pre><code>&gt;show dbs
</code></pre><p>提示以下错误</p>
<pre><code>E QUERY Error: listDatabases failed: 
        { &quot;note&quot; : &quot;from execCommand&quot;, &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;not master&quot; }
at Error (&lt;anonymous&gt;)
</code></pre><p>查看mongo状态</p>
<pre><code>&gt; rs.status()
{ &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;not running with --replSet&quot;, &quot;code&quot; : 76 }
</code></pre><p>每次登陆mongoShell后都需要执行以下命令</p>
<pre><code>&gt; rs.slaveOK()
2015-09-24T17:03:16.528+0800 E QUERY    TypeError: Object function () { return &quot;try rs.help()&quot;; } has no method &apos;slaveOK&apos;    at (shell):1:4
</code></pre><p>参考 MongoDB 3.0 复制集升级操作以及坑 <a href="http://dev.guanghe.tv/2015/05/mongdb3-upgrade-bug.html" target="_blank" rel="external">http://dev.guanghe.tv/2015/05/mongdb3-upgrade-bug.html</a></p>
<p>//查看状态</p>
<pre><code>&gt; rs.status()
{ &quot;ok&quot; : 0, &quot;errmsg&quot; : &quot;not running with --replSet&quot;, &quot;code&quot; : 76 }
</code></pre><p>查看运行时配置</p>
<pre><code>&gt; use admin
switched to db admin
&gt; db.runCommand(&quot;getCmdLineOpts&quot;)
{
    &quot;argv&quot; : [
        &quot;mongod&quot;,
        &quot;-f&quot;,
        &quot;/etc/mongod.cnf&quot;,
        &quot;-slave&quot;,
        &quot;-source&quot;,
        &quot;43.241.222.110:27017&quot;
    ],
    &quot;parsed&quot; : {
        &quot;config&quot; : &quot;/etc/mongod.cnf&quot;,
        &quot;net&quot; : {
            &quot;http&quot; : {
                &quot;enabled&quot; : false
            },
            &quot;port&quot; : 27017
        },
        &quot;processManagement&quot; : {
            &quot;fork&quot; : true
        },
        &quot;slave&quot; : true,
        &quot;source&quot; : &quot;43.241.222.110:27017&quot;,
        &quot;storage&quot; : {
            &quot;dbPath&quot; : &quot;/data/home/data/mongodb&quot;,
            &quot;engine&quot; : &quot;wiredTiger&quot;,
            &quot;wiredTiger&quot; : {
                &quot;collectionConfig&quot; : {
                    &quot;blockCompressor&quot; : &quot;snappy&quot;
                },
                &quot;engineConfig&quot; : {
                    &quot;cacheSizeGB&quot; : 20
                }
            }
        },
        &quot;systemLog&quot; : {
            &quot;destination&quot; : &quot;file&quot;,
            &quot;logAppend&quot; : true,
            &quot;path&quot; : &quot;/var/log/mongodb/mongod.log&quot;
        }
    },
    &quot;ok&quot; : 1
}
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-Mysql/MysqlTrigger" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/Mysql/MysqlTrigger/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/Mysql/MysqlTrigger/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Mysql__u89E6_u53D1_u5668_u76F8_u5173"><a href="#Mysql__u89E6_u53D1_u5668_u76F8_u5173" class="headerlink" title="Mysql 触发器相关"></a>Mysql 触发器相关</h3><hr>
<h4 id="u4E3B_u8981_u662F_u89E6_u53D1Redis_u6570_u636E_u5E93_u66F4_u65B0_2C_u4E00_u822C_u90FD_u6709_u4E09_u79CD_u64CD_u4F5C_2C_u5BF9_u4E8E_u6570_u636E_u8868_AdminCustomerInfo"><a href="#u4E3B_u8981_u662F_u89E6_u53D1Redis_u6570_u636E_u5E93_u66F4_u65B0_2C_u4E00_u822C_u90FD_u6709_u4E09_u79CD_u64CD_u4F5C_2C_u5BF9_u4E8E_u6570_u636E_u8868_AdminCustomerInfo" class="headerlink" title="主要是触发Redis数据库更新,一般都有三种操作,对于数据表 AdminCustomerInfo"></a>主要是触发Redis数据库更新,一般都有三种操作,对于数据表 AdminCustomerInfo</h4><blockquote>
<p>T_AdminCustomerInfo_AI -&gt; AfterInsert</p>
</blockquote>
<pre><code>BEGIN
  DECLARE asId varchar(20);
  SET asId = CONCAT(&quot;C-&quot;,NEW.aiId);
  SET @ret= redis_command_v2(&quot;HSET&quot;,&quot;AccountInfoList&quot;,asId,
               json_object
               (
                   asId,
                   NEW.aiId AS aiId,
                   NEW.identityCardId AS identityCardId,
                   NEW.aInfoName AS aInfoName,
                   NEW.aInfoPicture AS aInfoPicture,
                   NEW.aInfoPhone AS aInfoPhone,
                   NEW.aInfoEmail AS aInfoEmail,
                   NEW.companyJoinState AS companyJoinState,
                   NEW.companyId AS companyId,
                   NEW.aInfoQQ AS aInfoQQ,
                   NEW.qqBind AS qqBind,
                   NEW.weChatBind AS weChatBind,
                   NEW.weiBoBind AS weiBoBind,
                   NEW.mailNotify AS mailNotify,
                   NEW.smsNotify AS smsNotify,
                   NEW.weChatNotify AS weChatNotify,
                   NEW.accountName AS accountName,
                   NEW.Password AS Password,
                   NEW.aInfoLevel AS aInfoLevel,
                   NEW.Balance AS Balance,
                   NEW.lastLogin AS lastLogin,
                   NEW.manId AS manId
               )
  );
  INSERT INTO App_RunInfo( asId )VALUES( asId );
END
</code></pre><blockquote>
<p>T_AdminCustomerInfo_AU -&gt; AfterUpdate</p>
</blockquote>
<pre><code>BEGIN
  DECLARE asId varchar(20);
  SET asId = CONCAT(&quot;C-&quot;,NEW.aiId);
  SET @ret= redis_command_v2(&quot;HSET&quot;,&quot;AccountInfoList&quot;,asId,
               json_object
               (
                   asId,
                   NEW.aiId AS aiId,
                   NEW.identityCardId AS identityCardId,
                   NEW.aInfoName AS aInfoName,
                   NEW.aInfoPicture AS aInfoPicture,
                   NEW.aInfoPhone AS aInfoPhone,
                   NEW.aInfoEmail AS aInfoEmail,
                   NEW.companyJoinState AS companyJoinState,
                   NEW.companyId AS companyId,
                   NEW.aInfoQQ AS aInfoQQ,
                   NEW.qqBind AS qqBind,
                   NEW.weChatBind AS weChatBind,
                   NEW.weiBoBind AS weiBoBind,
                   NEW.mailNotify AS mailNotify,
                   NEW.smsNotify AS smsNotify,
                   NEW.weChatNotify AS weChatNotify,
                   NEW.accountName AS accountName,
                   NEW.Password AS Password,
                   NEW.aInfoLevel AS aInfoLevel,
                   NEW.Balance AS Balance,
                   NEW.lastLogin AS lastLogin,
                   NEW.manId AS manId
               )
  );
END
</code></pre><blockquote>
<p>T_AdminCustomerInfo_AD -&gt; AfterDelete</p>
</blockquote>
<pre><code>BEGIN
  DECLARE asId varchar(20);
  SET asId = CONCAT(&quot;C-&quot;,OLD.aiId);
  SET @ret= redis_command_v2(&quot;HDEL&quot;,&quot;AccountInfoList&quot;,asId);
  DELETE FROM App_RunInfo WHERE asId = asId;
END
</code></pre><hr>
<h3 id="u5176_u5B83_u6682_u5B58"><a href="#u5176_u5B83_u6682_u5B58" class="headerlink" title="其它暂存"></a>其它暂存</h3><blockquote>
<p>AccountTransaction =&gt; AccountTradePays 表同步</p>
</blockquote>
<h3 id="u4E00_u3001_u540C_u6B65_u63D2_u5165_u4EA4_u6613_u8BB0_u5F55"><a href="#u4E00_u3001_u540C_u6B65_u63D2_u5165_u4EA4_u6613_u8BB0_u5F55" class="headerlink" title="一、同步插入交易记录"></a>一、同步插入交易记录</h3><pre><code>DELIMITER ||
    DROP TRIGGER IF EXISTS T_AfterInsert_ON_AccountTransaction ||
    CREATE TRIGGER T_AfterInsert_ON_AccountTransaction
    AFTER INSERT ON AccountTransaction
    FOR EACH ROW
    BEGIN
        INSERT INTO AccountTradePays( pSerial, asId, tradeMoney, tradeWay, tradeSource, tradeTitle, tradeContent, tradeState, cBalance )
        VALUES( NEW.tSerial, NEW.asId, NEW.tradeMoney, NEW.tradeWay, NEW.tradeSource, NEW.tradeTitle, NEW.tradeContent, NEW.tradeState, NEW.cBalance );
    END||
DELIMITER

DELIMITER &amp;&amp;
CREATE TRIGGER tri_memory_insert AFTER Insert ON T FOR EACH ROW
BEGIN
    insert into tempT(id,strName) VALUES(NEW.id,NEW.strName);
END &amp;&amp;
DELIMITER ;
</code></pre><hr>
<h3 id="u4E8C_u3001_u540C_u6B65_u66F4_u65B0_u89E6_u53D1_u5668"><a href="#u4E8C_u3001_u540C_u6B65_u66F4_u65B0_u89E6_u53D1_u5668" class="headerlink" title="二、同步更新触发器"></a>二、同步更新触发器</h3><pre><code>DELIMITER $$
    /*[DEFINER = { user | CURRENT_USER }]*/
    CREATE TRIGGER `a`.`触发器名` BEFORE UPDATE ON `a`.`table1`
    FOR EACH ROW BEGIN
        IF new.id != old.id THEN
            UPDATE `b`.`table2` SET `b`.`table2`.id=new.id WHERE `b`.`table2`.val=old.val;
        END IF;
    END$$
DELIMITER;

DELIMITER &amp;&amp;
    CREATE TRIGGER T_AfterUpdate_ON_AccountTransaction
    AFTER UPDATE ON AccountTransaction
    FOR EACH ROW
    BEGIN
        UPDATE AccountTradePays SET tradeState=NEW.tradeState WHERE pSerial = &quot;AT-&quot; + OLD.tId;
    END &amp;&amp;
DELIMITER ;
</code></pre><hr>
<h3 id="u4E09_u3001_u540C_u6B65_u5220_u9664_u89E6_u53D1_u5668"><a href="#u4E09_u3001_u540C_u6B65_u5220_u9664_u89E6_u53D1_u5668" class="headerlink" title="三、同步删除触发器"></a>三、同步删除触发器</h3><pre><code>DELIMITER ||
    DROP TRIGGER IF EXISTS T_AfterDelete_ON_AccountTransaction ||
    CREATE TRIGGER T_AfterDelete_ON_AccountTransaction
    AFTER DELETE ON AccountTransaction
    FOR EACH ROW
    BEGIN
        DELETE FROM AccountTradePays WHERE pSerial = &quot;AT-&quot; + OLD.tId;
    END||
DELIMITER;
</code></pre><hr>
<pre><code>DELIMITER &amp;&amp;
    CREATE TRIGGER tri_memory_delete AFTER DELETE ON T FOR EACH ROW
    BEGIN
        DELETE From tempT where tempT.id = OLD.id;
    END &amp;&amp;
DELIMITER ;

DECLARE vv varchar(20);
    set vv=InsertToEmail(names,&quot;zyff@iirii.com&quot;);
    INSERT INTO user_info (name,age,email,addr) VALUES(names,33,&quot;zyf@iirii.com&quot;,&quot;湖北东西湖&quot;);


BEGIN
    DECLARE vv varchar(20);
    set vv=InsertToEmail(names,&quot;zyff@iirii.com&quot;);
    INSERT INTO user_info (name,age,email,addr) VALUES(names,33,&quot;zyf@iirii.com&quot;,&quot;湖北东西湖&quot;);
END

BEGIN
    DECLARE vv varchar(20);
    DECLARE vvv varchar(20);
    set vv=InsertToUploadsFun(names,&quot;zyfffff@iirii.com&quot;);
    set vvv=InsertToEmailFun(names);
    INSERT INTO user_info (name,age,email,addr) VALUES(names,33,&quot;zyf@iirii.com&quot;,&quot;湖北东西湖&quot;);
END
</code></pre><hr>
<pre><code>BEGIN
  DECLARE asId varchar(20);
  SET asId = CONCAT(&quot;C-&quot;,NEW.Id);
  SET @ret= redis_command_v2(&quot;HSET&quot;,&quot;crmInboxEventsS&quot;,asId,
                            json_object
                            (
                                  json_members
                                  (
                                          &quot;op&quot;,
                                          &quot;insert&quot;,
                                          &quot;asId&quot;,
                                          asId,
                                          &quot;value&quot;,
                                          json_object
                                          (
                                              NEW.Id as &quot;id&quot;,NEW.type as &quot;type&quot;,
                                              NEW.mailserver_id as &quot;mailserverId&quot;,NEW.sender as &quot;sender&quot;,
                                              NEW.sender_name as &quot;senderName&quot;,NEW.recevier as &quot;recevier&quot;,
                                              NEW.replyto as &quot;replyto&quot;,NEW.bbemails as &quot;bbemails&quot;,
                                              NEW.ccemails as &quot;ccemails&quot;,NEW.subject as &quot;subject&quot;
                                          )
                                      )
                              )
                        );
END
</code></pre><hr>
<pre><code>BEGIN
  DECLARE asId varchar(20);
  SET asId = CONCAT(&quot;C-&quot;,NEW.Id);
  SET @ret= redis_command_v2(&quot;HSET&quot;,&quot;crmInboxEventsS&quot;,asId,
               json_object
               (
                   NEW.Id as &quot;id&quot;,NEW.type as &quot;type&quot;,
                   NEW.mailserver_id as &quot;mailserverId&quot;,NEW.sender as &quot;sender&quot;,
                   NEW.sender_name as &quot;senderName&quot;,NEW.recevier as &quot;recevier&quot;,
                   NEW.replyto as &quot;replyto&quot;,NEW.bbemails as &quot;bbemails&quot;,
                   NEW.ccemails as &quot;ccemails&quot;,NEW.subject as &quot;subject&quot;
               )
  );
END
</code></pre>
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-Nginx/NginxNote" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/Nginx/NginxNote/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/Nginx/NginxNote/">NginxNote</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
              <h1 id="Nginx__u7B14_u8BB0"><a href="#Nginx__u7B14_u8BB0" class="headerlink" title="Nginx 笔记"></a>Nginx 笔记</h1><p><a href="http://www.nginx.org">Nginx 官网</a></p>
<h2 id="u4E0D_u9519_u7684Nginx_u5F00_u53D1_u8005_u535A_u5BA2"><a href="#u4E0D_u9519_u7684Nginx_u5F00_u53D1_u8005_u535A_u5BA2" class="headerlink" title="不错的Nginx开发者博客"></a>不错的Nginx开发者博客</h2><p><a href="http://www.just4coding.com/blog/categories/nginx/">Just For Coding</a></p>
          
      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
        <p class="article-more-link">
          <a  href="/2016/01/10/Nginx/NginxNote/#more">more >></a>
        </p>
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-Erlang/Elixir" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/Erlang/Elixir/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/Erlang/Elixir/">ElixirNote</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="Erlang__u52A8_u6001_u7F16_u7A0B_u8BED_u8A00_Elixir__u76F8_u5173"><a href="#Erlang__u52A8_u6001_u7F16_u7A0B_u8BED_u8A00_Elixir__u76F8_u5173" class="headerlink" title="Erlang 动态编程语言 Elixir 相关"></a>Erlang 动态编程语言 Elixir 相关</h3><p><a href="http://elixir-lang.org/getting-started/introduction.html" target="_blank" rel="external">Elixir 官网</a></p>
<p><a href="https://github.com/elixir-lang-china/elixir_guide_cn/blob/master/getting_started/Chapter2.md" target="_blank" rel="external">GitHub - elixir-lang-china/elixir_guide_cn</a><br><a href="https://github.com/straightdave/programming_elixir" target="_blank" rel="external">GitHub - straightdave/programming_elixir</a><br><a href="/"></a></p>
<hr>
<p>参考列表</p>
<p><a href="/"></a><br><a href="/"></a><br><a href="/"></a><br><a href="/"></a><br><a href="/"></a><br><a href="/"></a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-SSL/LetSSL" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/SSL/LetSSL/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/SSL/LetSSL/">Title</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="letsencrypt__u8BC1_u4E66_u7B7E_u53D1_u673A_u6784"><a href="#letsencrypt__u8BC1_u4E66_u7B7E_u53D1_u673A_u6784" class="headerlink" title="letsencrypt 证书签发机构"></a>letsencrypt 证书签发机构</h3><p><a href="https://letsencrypt.org/" target="_blank" rel="external">官网</a><br><a href="https://github.com/letsencrypt/letsencrypt" target="_blank" rel="external">GitHub - letsencrypt/letsencrypt</a></p>
<h3 id="letscrypt__u8BC1_u4E66_u7B7E_u53D1_u53CA_u4F7F_u7528_u95EE_u9898"><a href="#letscrypt__u8BC1_u4E66_u7B7E_u53D1_u53CA_u4F7F_u7528_u95EE_u9898" class="headerlink" title="letscrypt 证书签发及使用问题"></a>letscrypt 证书签发及使用问题</h3><pre><code>$ git clone https://github.com/letsencrypt/letsencrypt
$ cd letsencrypt
$ ./letsencrypt-auto --help
</code></pre><p>首先停止服务器正在运行的nginx 服务器</p>
<p>To obtain a cert using a “standalone” webserver (you may need to temporarily stop your exising webserver) for example.com and www.example.com:</p>
<h3 id="23_*-coopens-com_Certificate"><a href="#23_*-coopens-com_Certificate" class="headerlink" title="# *.coopens.com Certificate"></a><ip:42.96.194.60> # *.coopens.com Certificate</ip:42.96.194.60></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d coopens.com \
-d www.coopens.com \
-d 56.coopens.com \
-d app.coopens.com \
-d dp.coopens.com \
-d cp.coopens.com \
-d lp.coopens.com \
-d pp.coopens.com \
-d mp.coopens.com \
-d im.coopens.com \
-d sns.coopens.com \
-d blog.coopens.com \
-d gps.coopens.com \
-d lw.coopens.com \
-d ma.coopens.com \
-d mirror.coopens.com \
-d nw.coopens.com \
-d open.coopens.com \
-d pay.coopens.com \
-d forum.coopens.com
</code></pre><h3 id="23_*-nocs-com_Certificate"><a href="#23_*-nocs-com_Certificate" class="headerlink" title="# *.nocs.com Certificate"></a><ip:45.63.50.67> # *.nocs.com Certificate</ip:45.63.50.67></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d nocs.cn \
-d www.nocs.cn \
-d 56.nocs.cn \
-d app.nocs.cn \
-d dp.nocs.cn \
-d cp.nocs.cn \
-d lp.nocs.cn \
-d pp.nocs.cn \
-d mp.nocs.cn \
-d im.nocs.cn \
-d sns.nocs.cn \
-d blog.nocs.cn \
-d gps.nocs.cn \
-d lw.nocs.cn \
-d ma.nocs.cn \
-d mirror.nocs.cn \
-d nw.nocs.cn \
-d open.nocs.cn \
-d pay.nocs.cn \
-d forum.nocs.cn
</code></pre><h3 id="23_*-coam-com_Certificate"><a href="#23_*-coam-com_Certificate" class="headerlink" title="# *.coam.com Certificate"></a><ip:43.241.222.110> # *.coam.com Certificate</ip:43.241.222.110></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d coam.co \
-d www.coam.co \
-d 56.coam.co \
-d app.coam.co \
-d dp.coam.co \
-d cp.coam.co \
-d lp.coam.co \
-d pp.coam.co \
-d mp.coam.co \
-d im.coam.co \
-d sns.coam.co \
-d blog.coam.co \
-d gps.coam.co \
-d lw.coam.co \
-d ma.coam.co \
-d mirror.coam.co \
-d nw.coam.co \
-d open.coam.co \
-d pay.coam.co \
-d forum.coam.co
</code></pre><h3 id="23_*-syam-com_Certificate"><a href="#23_*-syam-com_Certificate" class="headerlink" title="# *.syam.com Certificate"></a><ip:43.241.222.110> # *.syam.com Certificate</ip:43.241.222.110></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d syam.cc \
-d www.syam.cc \
-d 56.syam.cc \
-d app.syam.cc \
-d dp.syam.cc \
-d cp.syam.cc \
-d lp.syam.cc \
-d pp.syam.cc \
-d mp.syam.cc \
-d im.syam.cc \
-d sns.syam.cc \
-d blog.syam.cc \
-d gps.syam.cc \
-d lw.syam.cc \
-d ma.syam.cc \
-d mirror.syam.cc \
-d nw.syam.cc \
-d open.syam.cc \
-d pay.syam.cc \
-d forum.syam.cc
</code></pre><h3 id="23_*-lonal-com_Certificate"><a href="#23_*-lonal-com_Certificate" class="headerlink" title="# *.lonal.com Certificate"></a><ip:43.241.222.110> # *.lonal.com Certificate</ip:43.241.222.110></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d lonal.com \
-d www.lonal.com \
-d 56.lonal.com \
-d app.lonal.com \
-d dp.lonal.com \
-d cp.lonal.com \
-d lp.lonal.com \
-d pp.lonal.com \
-d mp.lonal.com \
-d im.lonal.com \
-d sns.lonal.com \
-d blog.lonal.com \
-d gps.lonal.com \
-d lw.lonal.com \
-d ma.lonal.com \
-d mirror.lonal.com \
-d nw.lonal.com \
-d open.lonal.com \
-d pay.lonal.com \
-d forum.lonal.com
</code></pre><h3 id="23_*-iirii-com_Certificate"><a href="#23_*-iirii-com_Certificate" class="headerlink" title="# *.iirii.com Certificate"></a><ip:42.96.194.60> # *.iirii.com Certificate</ip:42.96.194.60></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d iirii.com \
-d www.iirii.com \
-d wp.iirii.com \
-d ash.iirii.com \
-d ftp.iirii.com \
-d sarah.iirii.com
</code></pre><h3 id="23_*-iirii-com_Certificate-1"><a href="#23_*-iirii-com_Certificate-1" class="headerlink" title="# *.iirii.com Certificate"></a><ip:43.241.222.110> # *.iirii.com Certificate</ip:43.241.222.110></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d msh.iirii.com
</code></pre><h3 id="23_*-iirii-com_Certificate-2"><a href="#23_*-iirii-com_Certificate-2" class="headerlink" title="# *.iirii.com Certificate"></a><ip:45.63.50.67> # *.iirii.com Certificate</ip:45.63.50.67></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d vsh.iirii.com
</code></pre><h3 id="23_*-apolloyl-com_Certificate"><a href="#23_*-apolloyl-com_Certificate" class="headerlink" title="# *.apolloyl.com Certificate"></a><ip:42.96.194.60> # *.apolloyl.com Certificate</ip:42.96.194.60></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d apolloyl.com \
-d www.apolloyl.com \
-d mirror.apolloyl.com \
-d t.apolloyl.com
</code></pre><h3 id="23_*-yntongji-com_Certificate"><a href="#23_*-yntongji-com_Certificate" class="headerlink" title="# *.yntongji.com Certificate"></a><ip:42.96.194.60> # *.yntongji.com Certificate</ip:42.96.194.60></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d yntongji.com \
-d www.yntongji.com \
-d open.yntongji.com \
-d t.yntongji.com
</code></pre><h3 id="23_*-hszhyy120-com_Certificate"><a href="#23_*-hszhyy120-com_Certificate" class="headerlink" title="# *.hszhyy120.com Certificate"></a><ip:42.96.194.60> # *.hszhyy120.com Certificate</ip:42.96.194.60></h3><pre><code>./letsencrypt-auto certonly --standalone \
-d hszhyy120.com \
-d www.hszhyy120.com \
-d open.hszhyy120.com \
-d t.hszhyy120.com
</code></pre><p>To obtain a cert using the “webroot” plugin, which can work with the webroot directory of any webserver software:</p>
<pre><code>./letsencrypt-auto certonly --webroot -w /var/www/example -d example.com -d www.example.com -w /var/www/thing -d thing.is -d m.thing.is
</code></pre><p>最后提示如下成功信息</p>
<pre><code>IMPORTANT NOTES:
 - Congratulations! Your certificate and chain have been saved at
   /etc/letsencrypt/live/coopens.com/fullchain.pem. Your cert will
   expire on 2016-03-22. To obtain a new version of the certificate in
   the future, simply run Let&apos;s Encrypt again.
 - If you like Let&apos;s Encrypt, please consider supporting our work by:

   Donating to ISRG / Let&apos;s Encrypt:   https://letsencrypt.org/donate
   Donating to EFF:                    https://eff.org/donate-le
</code></pre><p>按提示在 /etc/letsencrypt/live/coopens.com/fullchain.pem 四个文件</p>
<pre><code>cert.pem 
chain.pem
fullchain.pem
privkey.pem
</code></pre><p>修改相应的 coopens.com 配置</p>
<pre><code>#ssl_certificate /data/home/yzhang/GlobalSign/SYAM/syam.crt;
#ssl_certificate_key /data/home/yzhang/GlobalSign/SYAM/syam.key;
ssl_certificate /etc/letsencrypt/live/coopens.com/fullchain.pem;
ssl_certificate_key /etc/letsencrypt/live/coopens.com/privkey.pem;
</code></pre><p>重启 nginx 即可</p>
<hr>
<h5 id="u53C2_u8003_u5217_u8868"><a href="#u53C2_u8003_u5217_u8868" class="headerlink" title="参考列表"></a>参考列表</h5><p><a href="https://letsencrypt.org/howitworks/" target="_blank" rel="external">letsencrypt</a><br><a href="https://www.gehaowu.com/labs/2015/11/letsencrypt-https-certificate/" target="_blank" rel="external">使用 Let’s Encrypt 开源 SSL 证书</a><br><a href="https://mitnk.com/2015/11/lets_encrypt/" target="_blank" rel="external">为Nginx手动获取Let’S Encrypt的免费SSL证书</a><br><a href="https://linuxtoy.org/archives/lets-encrypt.html" target="_blank" rel="external">Let’s Encrypt 试用记</a></p>
<p><a href="https://www.hatoko.net/nginx/nginx-ssl.html" target="_blank" rel="external">Nginx下SSL配置解释</a><br><a href="https://johnmaguire.me/2015/12/configuring-nginx-lets-encrypt-automatic-renewal/" target="_blank" rel="external">Configuring Let’s Encrypt for nginx with Automatic Renewal</a><br><a href="/"></a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
    <article id="post-Erlang/Rebar" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/10/Erlang/Rebar/" class="article-date">
      <time datetime="2016-01-10T11:41:31.000Z" itemprop="datePublished">2016-01-10</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/10/Erlang/Rebar/">RebarNote</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="u4F7F_u7528_Rebar__u7BA1_u7406_erlang__u9879_u76EE"><a href="#u4F7F_u7528_Rebar__u7BA1_u7406_erlang__u9879_u76EE" class="headerlink" title="使用 Rebar 管理 erlang 项目"></a>使用 Rebar 管理 erlang 项目</h3><p><a href="https://github.com/rebar/rebar" target="_blank" rel="external">GitHub - </a></p>
<h4 id="u4F7F_u7528_Intellij_idea15__u5229_u7528_rebar__u5F00_u53D1_u8C03_u8BD5_ejabberd"><a href="#u4F7F_u7528_Intellij_idea15__u5229_u7528_rebar__u5F00_u53D1_u8C03_u8BD5_ejabberd" class="headerlink" title="使用 Intellij idea15 利用 rebar 开发调试 ejabberd"></a>使用 Intellij idea15 利用 rebar 开发调试 ejabberd</h4><blockquote>
<p>默认 Erlang 的 ejabberd 根项目下已经有 rebar 文件了</p>
</blockquote>
<p>1.Win下安装 <a href="http://www.erlang.org/download/otp_win64_18.2.1.exe" target="_blank" rel="external">otp.18</a> 到 G:\Program Files\erl7.2.1 下<br>2.将 G:\Program Files\erl7.2.1 添加系统环境变量 PATH<br>3.Intellij idea 项目 ejabberd 中 SDK 添加 OTP18.**<br>4.win下使用 Cygwin 安装 rebar</p>
<pre><code>$ git clone git://github.com/rebar/rebar.git
$ cd rebar
$ ./bootstrap
Recompile: src/getopt
...
Recompile: src/rebar_utils
==&gt; rebar (compile)
Congratulations! You now have a self-contained script called &quot;rebar&quot; in
your current working directory. Place this script anywhere in your path
and you can use rebar to build OTP-compliant apps.
</code></pre><p>它将自动将 rebar 安装到 C:\Users\yafei\rebar 下</p>
<ol>
<li><p>File-&gt;Other Setting-&gt;Default Setting-&gt;Erlang Extenal Tools 配置 PATH 为 C:\Users\yafei\rebar\rebar.cmd</p>
</li>
<li><p>File-&gt;Setting-&gt;Setting-&gt;In “Build, Execution, Deployment/Erlan Compiler”, 勾选 “Compile project with rebar”.</p>
</li>
</ol>
<p>6.Menu -&gt; Run -&gt; Edit Configurations -&gt; 添加按钮 -&gt; Erlang Rebar ,具体配置为 在 Command 一栏添加 任务 delete-deps clean get-deps compile 并任意填写一个任务名称 coamerlangtask</p>
<p>7.在 Intellij idea 右上角可以点击运行开始打包</p>
<hr>
<h3 id="u9519_u8BEF_u5206_u6790"><a href="#u9519_u8BEF_u5206_u6790" class="headerlink" title="错误分析"></a>错误分析</h3><blockquote>
<p>rebar unable to get dependency from github</p>
<p>使用简单的 clean compile 命令会出现很多未找到依赖包 * ,因为编译 compile 前先要 get-deps 所以将 rebar 编译命令改为 delete-deps clean get-deps compile</p>
</blockquote>
<p>参考 <a href="http://stackoverflow.com/questions/10059579/rebar-unable-to-get-dependency-from-github" target="_blank" rel="external">rebar unable to get dependency from github</a></p>
<hr>
<p>参考列表<br><a href="https://github.com/rebar/rebar/wiki/Rebar-commands" target="_blank" rel="external">Rebar commands</a><br><a href="http://zewaren.net/site/?q=node/144" target="_blank" rel="external">Using Intellij IDEA to write and debug Erlang code</a><br><a href="https://www.jetbrains.com/idea/help/getting-started-with-erlang.html#d207953e377" target="_blank" rel="external">Intellij Idea 官网说明</a><br><a href="http://blog.csdn.net/shake1050/article/details/43670281" target="_blank" rel="external">windows下使用IntelliJ IDEA的erlang编译环境搭建(含rebar工具)</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>








  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2016 张亚飞
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
            </div>
        </div>
        <div class="visit">
            <span id="busuanzi_container_site_pv" style='display:none'>
                <span id="site-visit" >本站到访数: 
                    <span id="busuanzi_value_site_uv"></span>
                </span>
            </span>
            <span id="busuanzi_container_page_pv" style='display:none'>
                <span id="page-visit">, 本页阅读量: 
                    <span id="busuanzi_value_page_pv"></span>
                </span>
            </span>
        </div>
    </div>
</footer>
    </div>
    <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>




<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>